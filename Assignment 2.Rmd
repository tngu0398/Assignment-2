---
title: "Assignment2_draft"
author: "Naveed Aamir, Jane Nguyen, Tony Nguyen, Shiyuan Zhang"
date: "2023-06-07"
output: 
  bookdown::html_document2:
  fig_caption: yes
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r LoadLibrary}
library(tidyverse)
library(plotly)
library(bookdown)
library(rnaturalearth)
library(rnaturalearthdata)
library(maps)
library(dslabs)
library(knitr)
library(scales)
library(dplyr)
library(gridExtra)
library(ISLR)
library(MASS)
library(tidyr)
library(ggplot2)
library(ggthemes)
library(ggrepel)
library(ggmap)
library(mapdata) 
library(kableExtra)
library(countrycode)
library(readr, quietly = T)
library(broom, quietly = T)
library(forecast, quietly = T)
library(repr, quietly = T)
library(lubridate, quietly = T)
library(janitor, quietly = T)
```

# ASSESSMENT 2 



## INTRODUCTION
Alcohol usage is a common occurrence in today's society, however the consumption amount varies across geographical regions and can be influenced by different factors. The report explores the relationship between total alcohol consumption and the geographical regions, as well as the significant influence of religion in alcohol usage globally.   

While it is commonly assumed males are the primary consumers of alcohol, this report goes beyond geographical considerations and investigates the prevalence of alcohol disorders among both males and females across various income groups. The aim is to identify any variations and temporal trends in alcohol-related issues.

Moreover, overconsumption of alcohol can harm an individual's health and safety, leading to relationships and/or financial problems. Alcohol use disorders affect people globally and causes death every year either directly, from alcohol-induced diseases such as liver diseases, neurodegenerative disorders, or heart failure, or indirectly from suicide.

While alcohol is often consumed for leisure, relaxation, and celebration, it unfortunately becomes a crutch for temporarily alleviating stress, grief, and sorrow. Furthermore, the consumption and types of alcohol have also become associated with social status. However, it is important to acknowledge that alcohol consumption can also lead to various disorders that may result in fatal consequences.

Thus, this report delves into the influence of income on alcohol consumption, explores the contributing variables to alcohol-related deaths, and discusses countries with the highest percentage of deaths attributed to alcohol use disorders.

```{r readData and review, echo=FALSE}
# Read data and review
alcohol <- read.csv("Data/alcohol.csv")
# *****
```

```{r LoadData2}
#Load merged data
data_init <- read.csv("Alcohol/Merge_all_2010_2020_updated.csv")

#Subset dataset for the section

data_init_mod <- data_init %>%
  c("Entity", "Year", "Code", "Death_alcohol_use_disorders")

data_init_mod <- data_init[, c("Entity", "Year", "Code", "Death_alcohol_use_disorders")]

```



```{r, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}

# read in data set 
data = read.csv('Merge_all_2010_2020_updated.csv')

```

```{r, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}

# extracting columns to use from data 
extractedData =  data[, c(1, 2, 3, 12)]

# omit NA values
newExtractedData = na.omit(extractedData)

```

*Question 1*

-   How has the total alcohol consumption per capita changed over time in relation to geographical regions?

**Analysis**

Table \@ref(tab:Table1) presented the overall median global growth of alcohol consumption from 2000 to 2018. However, Figure \@ref(fig:Figure1) revealed that regions were still experiencing diverging patterns during this period. Regions such as 'East Asia and Pacific', 'South Asia', 'North America' and 'Middle East and North Africa' increased in alcohol consumption, while other regions like 'Europe and Central Asia', 'Latin America and Caribbean' and 'Sub-Saharan Africa' experienced declines.

Table \@ref(tab:Table1) provided insights of the average (6.18L) and median (6.11L) alcohol consumption in 2010, this year stands as the highest in total consumption. Similarly, Figure 2 presents the visual depiction of countries around the world reaching their highest in 2010, followed by subsequent decrease.


**Table 1**

Table \@ref(tab:Table1) displays the IQR, the range, Mean and Median values of total alcohol consumption in 2000, 2005, 2010, 2015 and 2018

```{r Table1, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}

# 2000 data
y2000 = newExtractedData[newExtractedData $ Year == 2000, ]

year2000Total = summary(y2000 $ Total_alcohol_consumption_per_capita)

year2000TotalArray = as.array(year2000Total)

year2000TotalData = data.frame(Statistics = rownames(year2000TotalArray), Values = year2000TotalArray, stringsAsFactors = FALSE)


# 2005 data
y2005 = newExtractedData[newExtractedData $ Year == 2005, ]

year2005Total = summary(y2005 $ Total_alcohol_consumption_per_capita)

year2005TotalArray = as.array(year2005Total)

year2005TotalData = data.frame(Statistics = rownames(year2005TotalArray), Values = year2005TotalArray, stringsAsFactors = FALSE)


# 2010 data
y2010 = newExtractedData[newExtractedData $ Year == 2010, ]

year2010Total = summary(y2010 $ Total_alcohol_consumption_per_capita)

year2010TotalArray = as.array(year2010Total)

year2010TotalData = data.frame(Statistics = rownames(year2010TotalArray), Values = year2010TotalArray, stringsAsFactors = FALSE)


# 2015 data
y2015 = newExtractedData[newExtractedData $ Year == 2015, ]

year2015Total = summary(y2015 $ Total_alcohol_consumption_per_capita)

year2015TotalArray = as.array(year2015Total)

year2015TotalData = data.frame(Statistics = rownames(year2015TotalArray), Values = year2015TotalArray, stringsAsFactors = FALSE)


# 2018 data
y2018 = newExtractedData[newExtractedData $ Year == 2018, ]

year2018Total = summary(y2018 $ Total_alcohol_consumption_per_capita)

year2018TotalArray = as.array(year2018Total)

year2018TotalData = data.frame(Statistics = rownames(year2018TotalArray), Values = year2018TotalArray, stringsAsFactors = FALSE)


# combining columns 
totalCombinedSummary = cbind(year2000TotalData$Statistics, year2000TotalData$Values.Freq, year2005TotalData$Values.Freq, year2010TotalData$Values.Freq, year2015TotalData$Values.Freq, year2018TotalData$Values.Freq)

# renaming columns 
colnames(totalCombinedSummary) = c("Statistics", "2000", "2005", "2010", "2015", "2018")

# presenting using kable()
kable(totalCombinedSummary, format = "html", align = "c", caption = "Alcohol Consumption Statistics throughout the Years") %>% kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)

```




# Section Naveed {.tabset}


## Question 1

- Do people with higher income consume more alcohol and how does the consumption of alcohol vary with an increase in income?

```{r plot1, fig.cap="plot1"}

options(scipen = 999)


# Wrangle and get the data ready for the model
alcohol2 <- filter(alcohol, GDP_per_capita>=0, GDP_per_capita<=70000) %>% select(Entity,GDP_per_capita,Total_alcohol_consumption_per_capita)

alcohol3 <- na.omit(alcohol2)

# scatter plot of consumption per person vs income
sp <- ggplot(data = alcohol3, aes(x = GDP_per_capita, y = Total_alcohol_consumption_per_capita)) +
  geom_point() + labs(title = "Pure Alcohol Consumption per person with Income",x = "GDP Per Capita (USD)",y = "Pure Alcohol Consumption per Capita (Litres)",subtitle = "Consumption of alcohol per person increases with Income and eventually becomes constant", caption = "Alcohol Consumption Data 2000-2020")



spi <- ggplotly(sp) %>% layout(title = list(text = paste0("Variation in Pure Alcohol Consumption per person with Income",
                                                          "<br>",
                                                          "<sup>",
                                                          "Consumption of alcohol per person increases with Income and eventually becomes constant",
                                                          "</sup>")), x = "Income per person (USD)", y = "Pure Alcohol Consumption per person (Litres)",
                               annotations = list(x=1, y=-0.1, text = "Alcohol Consumption Data 2000-2020", showarrow = F, xref = 'paper', yref = 'paper', xanchor = 'right', yanchor = 'auto', xshift = 0, yshift = 0, font = list(size=10, colour="red")))
spi
# *****
```
```{r plot2, fig.cap="plot2"}
# Fit a simple linear regression model of consumption per person on income
con_fit <- lm(Total_alcohol_consumption_per_capita~GDP_per_capita, data=alcohol3)
#tidy(con_fit)
# Add predictions, residuals, etc. to the training data
con_model <- augment(con_fit, alcohol3)

# Fitting the estimated model over the data
con_mod <- ggplot(con_model, aes(x=GDP_per_capita, y=Total_alcohol_consumption_per_capita)) + 
  geom_point() + labs(title = "Linear Model of Pure Alcohol Consumption per person on Income",x = "GDP Per Capita (USD)",y = "Pure Alcohol Consumption per Capita (Litres)",subtitle = "The relationship between Consumption per person and Income is not linear", caption = "Alcohol Consumption Data 2000-2020") + geom_line(aes(y=.fitted), colour="blue")
  
con_modi <- ggplotly(con_mod) %>% layout(title = list(text = paste0("Linear Model of Pure Alcohol Consumption per person on Income",
                                                          "<br>",
                                                          "<sup>",
                                                          "The relationship between Consumption per person and Income is not linear",
                                                          "</sup>")), x = "GDP Per Capita (USD)", y = "Pure Alcohol Consumption per person (Litres)",
                               annotations = list(x=1, y=-0.1, text = "Alcohol Consumption Data 2000-2020", showarrow = F, xref = 'paper', yref = 'paper', xanchor = 'right', yanchor = 'auto', xshift = 0, yshift = 0, font = list(size=10, colour="red")))

options(scipen = 999)
con_modi
# *****
```

```{r summarytable1, tab.cap="summarytable1"}
# Summary of the fitted linear regression model
con_lin_fit <- lm(formula = Total_alcohol_consumption_per_capita ~ GDP_per_capita, data = alcohol3)

# Return a summary of the fitted linear regression model
summary(con_lin_fit)
# *****
```

```{r}
# Examine outliers
alc_outliers <- arrange(alcohol3, desc(Total_alcohol_consumption_per_capita))
# *****
```

```{r SummaryTable2}
# Table that displays five countries each for both highest gdp per capita and lowest gdp per capita
alcohol10 <- arrange(alcohol3, desc(GDP_per_capita))

alcohol_gdp <- filter(alcohol10, Entity %in% c("Switzerland", "Brunei", "United Arab Emirates", "Norway", "United States", "Burundi", "Central African Republic", "Democratic Republic of Congo", "Somalia", "Mozambique"))

knitr::kable(alcohol_gdp, caption = "Some countries with one of the highest and lowest GDP Per Capita and their corresponding alcohol consummption per capita")
# *****
```

- The scatter plot in (Figure \@ref(fig:plot1)) does show that, in general, consumption of alcohol is found to be higher for people with higher income.

- At first, the consumption of alcohol increases exponentially as income increases and then becomes approximately constant around and beyond a GDP Per Capita of USD 20000.

- The summary table of the linear regression model of consumption per person on income in shows that for an increase of USD 1000 in income the consumption of alcohol per person increases by 105.2 ml

- The overall p-value and the one for the variable GDP Per Capita is much lower than the usual significance level of 5%. which shows that alcohol consumption per person is dependant on income.

- However, the linear regression model only explains about 18.13% of the variation in alcohol consumption per person, which suggests that the relationship between alcohol consumption per person and income may not be linear and the model is not very accurate.

- This is confirmed by the plot of the fitted linear regression model in (Figure \@ref(fig:plot2)), which also shows that most of the observations lie above the line of best fit and suggests a curved relationship instead.

- Therefore, the relationship is not linear and the model can be optimized further.

- With a GDP Per Capita of approximately USD 27500, Seychelles is an outlier Ritchie et al. [2018]. and has the highest alcohol consumption per person of 20.5 L, further research may confirm if this because Seychelles is a very popular tourist and retirement spot.

- With a GDP Per Capita of approximately USD 27600, Malaysia is also an outlier Ritchie et al. [2018]. and has one of the lowest alcohol consumption per person of 0.85 L, further research may confirm if this because of religious influence, lack of preference and a lack of affordability in Malaysia.

- The table in \@ref(tab:SummaryTable2) shows countries with various GDP Per Capita and reiterates the fact that countries with higher income such as Switzerland, Norway and the United States have a higher alcohol consumption per person compared to countries with lower income such as Congo, Somalia and Mozambique. This table also confirms the earlier analysis that after a particular income level the alcohol consumption per person is relatively constant.

- However, further research into the outlier Burundi with a GDP Per Capita of approximately only USD 800 but a nearly 400% higher alcohol consumption per person compared to the other lower income countries mentioned above, may suggest it to be the result of cultural influence.

- Similarly, both the outliers UAE and Brunei as compared to the other countries with high income mentioned above have a comparatively low alcohol consumption per person. Further research may help to determine if this a result of religious influence in the respective countries.



## Question 2

- Is death dependant on consumption, income and alcohol household expense? Which countries had the highest percentage of deaths from alcohol use disorders in 2015? Are there any interesting findings and any possible potential underlying reasons? 

```{r}
# select variables for regression
selected.var <- c(4, 6, 11, 12)
# partition data
set.seed(1)  # set seed for reproducing the partition
train.index <- sample(c(1:3618), 2000) 
train.df <- alcohol[train.index, selected.var]
test.df <- alcohol[-train.index, selected.var]

# death regress on consumption, income and alcohol household expense
death_m <- lm(Death_alcohol_use_disorders ~., data = train.df)
options(scipen = 999)
summary(death_m)
# *****
```

```{r plotA, fig.cap="plotA"}
# % death in alcohol use disorders vs alcohol consumption per capita
sp_death_con <- ggplot(data = alcohol, aes(x = Total_alcohol_consumption_per_capita, y = Death_alcohol_use_disorders)) +
  geom_point() + labs(title = "Variation in death in alcohol use disorders",x = "Pure Alcohol Consumption per Capita (Litres)",y = "Death in alcohol use disorders(%)",subtitle = "Percentage death increases with an increase in alcohol consumption per person", caption = "Alcohol Consumption Data 2000-2020")



sp_death_coni <- ggplotly(sp_death_con) %>% layout(title = list(text = paste0("Variation in death in alcohol use disorders",
                                                          "<br>",
                                                          "<sup>",
                                                          "Percentage death increases with an increase in alcohol consumption per person",
                                                          "</sup>")), x = "Pure Alcohol Consumption per Capita (Litres)", y = "Death in alcohol use disorders(%)",
                               annotations = list(x=1, y=-0.1, text = "Alcohol Consumption Data 2000-2020", showarrow = F, xref = 'paper', yref = 'paper', xanchor = 'right', yanchor = 'auto', xshift = 0, yshift = 0, font = list(size=10, colour="red")))


sp_death_coni
```

```{r plotB, fig.cap="plotB"}
# % death in alcohol use disorders vs GDP Per Capita
sp_death_gdp <- ggplot(data = alcohol, aes(x = GDP_per_capita, y = Death_alcohol_use_disorders)) +
  geom_point() + labs(title = "Variation in death in alcohol use disorders with increase in income",x = "GDP Per Capita (USD)",y = "Death in alcohol use disorders(%)",subtitle = "Percentage death decreases with an increase in GDP Per Capita", caption = "Alcohol Consumption Data 2000-2020")

sp_death_gdpi <- ggplotly(sp_death_gdp) %>% layout(title = list(text = paste0("Variation in death in alcohol use disorders with increase in income",
                                                          "<br>",
                                                          "<sup>",
                                                          "Percentage death decreases with an increase in GDP Per Capita",
                                                          "</sup>")), x = "GDP Per Capita (USD)", y = "Death in alcohol use disorders(%)",
                               annotations = list(x=1, y=-0.1, text = "Alcohol Consumption Data 2000-2020", showarrow = F, xref = 'paper', yref = 'paper', xanchor = 'right', yanchor = 'auto', xshift = 0, yshift = 0, font = list(size=10, colour="red")))


sp_death_gdpi
# *****
```

```{r plotC, fig.cap="plotC"}
# % death in alcohol use disorders vs household alcohol expense
sp_death_exp <- ggplot(data = alcohol, aes(x = Alcohol_expenditure_rate_per_household, y = Death_alcohol_use_disorders)) +
  geom_point() + labs(title = "Variation in death in alcohol use disorders with increase in household alcohol expense",x = "Household Alcohol Expense (%)",y = "Death in alcohol use disorders(%)",subtitle = "Percentage death increases with an increase in houeshold alcohol expense", caption = "Alcohol Consumption Data 2000-2020")

sp_death_expi <- ggplotly(sp_death_exp) %>% layout(title = list(text = paste0("Variation in death in alcohol use disorders with increase in household alcohol expense",
                                                          "<br>",
                                                          "<sup>",
                                                          "Percentage death increases with an increase in houeshold alcohol expense",
                                                          "</sup>")), x = "Household Alcohol Expense (%)", y = "Death in alcohol use disorders(%)",
                               annotations = list(x=1, y=-0.1, text = "Alcohol Consumption Data 2000-2020", showarrow = F, xref = 'paper', yref = 'paper', xanchor = 'right', yanchor = 'auto', xshift = 0, yshift = 0, font = list(size=10, colour="red")))


sp_death_expi
# *****
```

```{r SummaryTableA}
# countries in 2015
countries_2015 <- filter(alcohol, Year == 2015) %>% select(Entity, Death_alcohol_use_disorders, Total_alcohol_consumption_per_capita, GDP_per_capita, Alcohol_expenditure_rate_per_household) 

# top 7 countries with highest percentage of alcohol related deaths in 2015
countries_deaths <- filter(countries_2015, Death_alcohol_use_disorders >= 12.5, Death_alcohol_use_disorders <= 22) 

countries_deaths_highest <-  arrange(countries_deaths, desc(Death_alcohol_use_disorders))

knitr::kable(countries_deaths_highest, caption = "The top 7 countries with the highest percentage of deaths in alcohol use disorders in 2015")

# *****
```

- The Multiple Linear Regression model of percentage death (in alcohol use disorders) regressed on consumption, income and household alcohol expense has been used to investigate Question 2.

- The model summary table, shows that a 1 Litre increase in annual pure alcohol consumption per person increases the death percentage in alcohol use disorder by 1.179%.

- However, an increase of USD 10000 in GDP Per Capita decreases the percentage death in alcohol use disorder by 1.5% and an increase of 1% in the weekly household alcohol expense increases the percentage death in alcohol use disorder by 0.5%

- The overall p-value is lower than the usual significance value of 5%, which suggests that percentage death in alcohol use disorders is dependant on the predictors present in the model. 

- The Multiple R-Squared value in the model summary table shows that the model explains 56.65% of the variation in percentage deaths in alcohol use disorders. Therefore, the model may be considered to be accurate, however, there is space for improvement.

- The scatter plot in (Figure \@ref(fig:plotA)) of deaths from alcohol use disorders vs alcohol consumption per person shows that at first the percentage death increases slightly with an increase in consumption but then it increases exponentially beyond approximately 7.5 litres.

- The scatter plot in (Figure \@ref(fig:plotB)) of deaths from alcohol use disorders vs GDP Per Capita shows that the percentage death is higher for countries with low GDP Per Capita and then the percentage death decreases exponentially as GDP Per Capita increases till it eventually almost becomes constant.

- Further research may determine whether this decline in percentage deaths may be a result of the ***availability of safer and better quality alcohol for consumption, better individual health, quality of healthcare and affordability of better healthcare***. These may also be some of the **additional predictors** that may help explain the remaining 55% of variation in deaths from alcohol use disorders.

- The scatter plot in (Figure \@ref(fig:plotC)) of deaths from alcohol use disorders vs household alcohol expense shows that the percentage death is about constant at first but then increases exponentially beyond a household alcohol expense of 1.5%. This is contrary to the earlier description of the relationship between the same two variables by the Multiple Linear Regression model. Some of the observed outliers may be a result of the **additional predictors** mentioned above. This scatter plot is also reflective of the deaths from alcohol use disorders vs alcohol consumption per person in Fig B and, therefore, reaffirms that percentage death is dependant on the alcohol consumption per person.

- The above scatter plots also help explain why the Multiple Linear Regression model used explains only approximately 57% of the variation in percentage deaths in alcohol use orders because the relation between the dependant and independant variables does not appear to be linear. Therefore, the model should be optimized further.

- The table in \@ref(tab:SummaryTableA), shows two of the outliers El Salvador and Gautemala, both of which had one of the highest percentage deaths in alcohol use disorders in 2015 but one of the lowest alcohol consumption per capita of 3.59 litres and 2.55 litres respectively. Further research may help determine whether some of the **additional predictors** mentioned above such as consumption of unsafe and low quality alcohol, comparatively poorer individual health, lack of quality and affordable healthcare contributed to the high percentage of deaths in alcohol use disorders for these countries.  




# Section Jane {.tabset}


## Question 1

**Figure 1**

Figure \@ref(fig:Figure1) displays the trends in total alcohol consumption across geographical regions from 2000 to 2018, with the World's rate shown as a dot-dashed line

-   'Europe and Central Asia' region experienced a notable decrease in consumption, while 'Latin America and Caribbean' and 'Sub-Saharan Africa' regions saw slight declines

-   'East Asia and Pacific' and 'South Asia' regions presented rapid growth, particularly between 2005 and 2010

-   'North America' and 'Middle East and North Africa' regions had minor increases, however the 'Middle East and North Africa' remained the lowest

```{r Figure1, fig.cap = "Region Chart", echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}

# selecting specific regions 
specifiedRegions = c("World", "East Asia and Pacific", "Europe and Central Asia", "Latin America and Caribbean", "Middle East and North Africa", "North America", "South Asia", "Sub-Saharan Africa")

specifiedRegionsData = newExtractedData %>% filter(Entity %in% specifiedRegions)

# create chart with World being a dotdash line type 
regionChart = ggplot(specifiedRegionsData, aes(x = Year, y = Total_alcohol_consumption_per_capita, group = Entity, color = Entity)) + geom_line(aes(linetype= if_else(Entity == "World", "solid", "dotdash"))) + geom_point() + labs(x = "Year", y = "Alcohol Consumption in Litres", title = "Total Alcohol Consumption by Geographical Region") + scale_linetype_manual(values = c("solid", "dotdash"), guide = FALSE) + theme_minimal()

regionChart

```



*Question 2*

-   How does the influence of religion relate to variations in total alcohol consumption per capita across different locations?

**Analysis**

Figure \@ref(fig:Figure1) highlighted the region 'Middle East and North Africa' as having had experienced the least growth and changes from 2000 to 2018 in comparison to the others. Notably, 'Middle East and North Africa' consistently exhibited the lowest alcohol consumption (consuming less than 1L each year). Similarly, Figure 2 shows the geographical locations: the Middle East, North Africa and the Greater Indonesia to have had minor changes over the years.

Table \@ref(tab:Table2) demonstrates consistency among the lowest 10 countries in alcohol consumption over the years, with only minor variations. Interestingly, a significant number of these countries are known for their devotion of Islamic values.

Although the impact of religion on alcohol consumption cannot be definitively determined without further global religious information. Figure \@ref(fig:Figure1), Table \@ref(tab:Table2) and Figure 2 suggest that these locations (the Middle East, North Africa and the Greater Indonesia) may experience lower alcohol consumption due to religious beliefs.



**Figure 2**

Figure 2 presents the alcohol consumption per capita in 2000, 2005, 2010, 2015 and 2018. Some notable observations are:

-   In 2000, Russia showed high alcohol consumption but over time it declined to 11.19L in 2018

-   In 2010, most countries had their highest rate of alcohol consumption

-   From 2000 to 2018, the majority of North Africa, the Middle East and the Greater Indonesia regions presented minimal changes in alcohol consumption - this may be attributed by Islamic beliefs as the Quran deems drinking as haram

```{r, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}

# loading world map 
worldMap = map_data("world")

# selecting specific year 2000
extractedData2000 = filter(newExtractedData, Year == 2000)

worldMap $ iso3c = countrycode(worldMap$region, 'country.name', 'iso3c')

extractedData2000Map = left_join(worldMap, extractedData2000, by = c("iso3c" = "Code"))

# heat map based on total alcohol consumption in 2000 
dataMap2000 = ggplot() + geom_map(data = extractedData2000Map, map = extractedData2000Map, aes(x = long, y = lat, map_id = region, fill = Total_alcohol_consumption_per_capita), color = "black") + coord_equal() + theme_void() + scale_fill_gradient2(low = "white", mid = "lightblue", high = "darkred", name = "Alcohol Consumed (Litres)") + labs(title = "2000 Alcohol Consumption per Capita")


# selecting specific year 2005
extractedData2005 = filter(newExtractedData, Year == 2005)

extractedData2005Map = left_join(worldMap, extractedData2005, by = c("iso3c" = "Code"))

# heat map based on total alcohol consumption in 2005 
dataMap2005 = ggplot() + geom_map(data = extractedData2005Map, map = extractedData2005Map, aes(x = long, y = lat, map_id = region, fill = Total_alcohol_consumption_per_capita), color = "black") + coord_equal() + theme_void() + scale_fill_gradient2(low = "white", mid = "lightblue", high = "darkred", name = "Alcohol Consumed (Litres)") + labs(title = "2005 Alcohol Consumption per Capita")


# selecting specific year 2010
extractedData2010 = filter(newExtractedData, Year == 2010)

extractedData2010Map = left_join(worldMap, extractedData2010, by = c("iso3c" = "Code"))

# heat map based on total alcohol consumption in 2010 
dataMap2010 = ggplot() + geom_map(data = extractedData2010Map, map = extractedData2010Map, aes(x = long, y = lat, map_id = region, fill = Total_alcohol_consumption_per_capita), color = "black") + coord_equal() + theme_void() + scale_fill_gradient2(low = "white", mid = "lightblue", high = "darkred", name = "Alcohol Consumed (Litres)") + labs(title = "2010 Alcohol Consumption per Capita")


# selecting specific year 2015
extractedData2015 = filter(newExtractedData, Year == 2015)

extractedData2015Map = left_join(worldMap, extractedData2015, by = c("iso3c" = "Code"))

# heat map based on total alcohol consumption in 2015 
dataMap2015 = ggplot() + geom_map(data = extractedData2015Map, map = extractedData2015Map, aes(x = long, y = lat, map_id = region, fill = Total_alcohol_consumption_per_capita), color = "black") + coord_equal() + theme_void() + scale_fill_gradient2(low = "white", mid = "lightblue", high = "darkred", name = "Alcohol Consumed (Litres)") + labs(title = "2015 Alcohol Consumption per Capita")


# selecting specific year 2018
extractedData2018 = filter(newExtractedData, Year == 2018)   

extractedData2018Map = left_join(worldMap, extractedData2018, by = c("iso3c" = "Code"))

# heat map based on total alcohol consumption in 2018 
dataMap2018 = ggplot() + geom_map(data = extractedData2018Map, map = extractedData2018Map, aes(x = long, y = lat, map_id = region, fill = Total_alcohol_consumption_per_capita), color = "black") + coord_equal() + theme_void() + scale_fill_gradient2(low = "white", mid = "lightblue", high = "darkred", name = "Alcohol Consumed (Litres)") + labs(title = "2018 Alcohol Consumption per Capita")


# display graphs using par()
par(mfrow = c(3, 2))
plot(dataMap2000)
plot(dataMap2005)
plot(dataMap2010)
plot(dataMap2015)
plot(dataMap2018)

```



**Table 2**

Table \@ref(tab:Table2) presents the lowest 10 countries in 2000, 2005, 2010, 2015 and 2018 in alcohol consumption

```{r Table2, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}

# calculating the total alcohol consumption in 2000
total2000 = extractedData2000 %>% group_by(Entity) %>% summarize(Total = sum(Total_alcohol_consumption_per_capita))

# arranging total consumption in descending order
topTotal2000 = arrange(total2000, desc(Total))

# selecting the bottom 15 countries in 2000
tailTotal2000 = tail(topTotal2000, 10)


# calculating the total alcohol consumption in 2005
total2005 = extractedData2005 %>% group_by(Entity) %>% summarize(Total = sum(Total_alcohol_consumption_per_capita))

# arranging total consumption in descending order
topTotal2005 = arrange(total2005, desc(Total))

# selecting the bottom 15 countries in 2005
tailTotal2005 = tail(topTotal2005, 10)


# calculating the total alcohol consumption in 2010
total2010 = extractedData2010 %>% group_by(Entity) %>% summarize(Total = sum(Total_alcohol_consumption_per_capita))

# arranging total consumption in descending order
topTotal2010 = arrange(total2010, desc(Total))

# selecting the bottom 15 countries in 2010
tailTotal2010 = tail(topTotal2010, 10)


# calculating the total alcohol consumption in 2015
total2015 = extractedData2015 %>% group_by(Entity) %>% summarize(Total = sum(Total_alcohol_consumption_per_capita))

# arranging total consumption in descending order
topTotal2015 = arrange(total2015, desc(Total))

# selecting the bottom 15 countries in 2015
tailTotal2015 = tail(topTotal2015, 10)


# calculating the total alcohol consumption in 2018
total2018 = extractedData2018 %>% group_by(Entity) %>% summarize(Total = sum(Total_alcohol_consumption_per_capita))

# arranging total consumption in descending order
topTotal2018 = arrange(total2018, desc(Total))

# selecting the bottom 15 countries in 2018
tailTotal2018 = tail(topTotal2018, 10)


# combining the data for each year into one 
combinedData = bind_rows(mutate(tailTotal2000, Year = 2000), mutate(tailTotal2005, Year = 2005), mutate(tailTotal2010, Year = 2010), mutate(tailTotal2015, Year = 2015), mutate(tailTotal2018, Year = 2018))

# creating separate columns for each year
combinedData = pivot_wider(data = combinedData, id_cols = Entity, names_from = Year, values_from = Total)

# converting to character type and replacing NA values with '-'
combinedData = combinedData %>% mutate(across(everything(), as.character)) %>% replace_na(list(`2000` = '-', `2005` = '-', `2010` = '-', `2015` = '-', `2018` = '-'))

# display table using kable()
kable(combinedData, format = "html", align = "c", caption = "Bottom 10 Countries in Alcohol Consumption (Litres)") %>% kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)

```

**Gloria'section**

***Research questions***
Consuming too much alcohol and not being able to control drinking can harm an individual's physical or mental health and safety, causing to family or financial problems. Alcohol use disorders widely affect people across the globe. In this section, we will examine the death caused by alcohol use disorders __directly__ worldwide and attempt to answer the following two questions:

1. Which countries worldwide were most affected by alcohol use disorders?

2. Has the situation improved or got worse over the past ten years?


***Countries in cold areas tend to be more affected by alcohol use disorders. {.tabset}***

Belarus and Mongolia had the highest __direct__ death rates (not including indirect death from suicide) of 21.80 and 17.05 per 100,000 people, respectively, followed by Russia, El Salvador, and Greenland (Table \@ref(tab:TableSummary1)).

Most of the countries with high death rates are in the subarctic or arctic zones in the northern hemisphere (Figure \@ref(fig:Visual1)). This is in line with findings from section 1. The cold and dark climates in these countries might have contributed to this observation.

However, countries in hot and humid weather such as Guatemala and Brazil also had high death rates from alcohol abuse. Countries in the southern subarctic zone with high alcohol consumption levels only showed low to moderate death rates. Therefore, cultural, genetic, historical, and religious factors cannot be ignored when investigating the underlying reason of high death rates in these countries.

****Plot****

```{r Visual1, fig.cap = "\\label{fig:Visual1}Annual Death rates from alcohol", echo = FALSE, warning = FALSE, message = FALSE}
# Load world map data
world<-map_data("world")

# Create data set and merge with map data
data_visual1 <- data_init_mod %>%
  rename("region" = "Entity") %>%
  filter(!is.na(Death_alcohol_use_disorders) & !Year %in% c("2000", "2005")) %>%
  group_by(region) %>%
  summarize(Mean = mean(Death_alcohol_use_disorders, na.rm = TRUE))

data_visual1 <- left_join(world, data_visual1, by = "region")

# Create heat map
visual_1 <- ggplot(data_visual1,aes(long,lat,group = group, fill = Mean, label = region)) +
  geom_polygon(color="white") +
  scale_fill_gradient(low="lightblue",high="red", name = "Death") +
  theme(panel.background = element_rect(fill = "lightgrey")) +
  xlab("") +
  ylab("Latitude") 

# Make plot interactive and add title and subtitle
visual_1_interactive <- ggplotly(visual_1) %>%
  layout(title = list(text = paste0("Death caused by alcohol use disorders",
                                    "<br>",
                                    "<sup>",
                                    "Average annual number of death from alcohol use disorder per 100,000 people",
                                    "</sup>")),
      annotations = list(x = 1, y = -0.1, text = "Data retreived from https://ourworldindata.org/alcohol-consumption.",
                         showarrow = F, xref='paper', yref='paper',
                         xanchor='right', yanchor='auto',
                         xshift=0, yshift=5,
                         font=list(size=10, color="black")))

visual_1_interactive

```

****Table****

```{r TableSummary1, echo = FALSE, warning = FALSE, message = FALSE}

data_table1 <- data_init_mod %>%
  filter(!is.na(Death_alcohol_use_disorders) & !Year %in% c("2000", "2005")) %>%
  group_by(Entity) %>%
  summarize(Mean = mean(Death_alcohol_use_disorders, na.rm = TRUE)) %>%
  arrange(desc(Mean)) %>%
  top_n(20)

# Make the table
table1 <- knitr::kable(data_table1,
                       digits = 2,
                       caption = "The top 20 countries with highest annual number of death caused by alcohol use disorders.")

table1
```


***The numbers fluctuate, but we have seen some improvements. {.tabset}***

Table \@ref(tab:TableSummary2) shows the standard deviations of %death from alcohol per country from 2010-2019. Most countries with high variances also had high average %death rates such as Kazakhstan, Guatemala, Russia, Mongolia, etc.

In figure \@ref(fig:Visualtrend), rate groups are classified by the average annual %death rates over 2010-2019 into low (group1, <=1st quarter), medium (group2, <3rd quarter & >1st quarter) and high (group3, >=3st quarter). Only the top ten countries are shown in each group. __Note that the y axis are different in each subplot.__ This is to illustrate the trends in each group.

Zooming in onto the global trends, we can see that:

- Most countries with both medium and high average annual %death from alcohol showed some improvements with a decreased %death rate.

- Countries with low average annual %death from alcohol had more fluctuations and some even showed a slight increase.


****Plot****
```{r Visualtrend, fig.cap= "\\label{fig:Visualtrend}Changes of death rates from alcohol in selected countries 2010-2019", echo = FALSE, warning = FALSE, message = FALSE}
# Classfy groups depending on the mean %death over 2010-2019
data_rank <- data_init_mod %>%
  group_by(Entity) %>%
  summarize(Mean = mean(Death_alcohol_use_disorders, na.rm = TRUE)) %>%
  mutate(rategroup = case_when(Mean >=2.752 ~ "3",
                               Mean <2.752 & Mean >0.920 ~ "2",
                               Mean <=0.920 ~ "1"))

# Create list of countries with high, medium, low %death rates
data_rank_low <- data_rank %>%
  filter(rategroup == "1") %>%
  arrange(desc(Mean))

data_rank_medium <- data_rank %>%
  filter(rategroup == "2") %>%
  arrange(desc(Mean))

data_rank_high <- data_rank %>%
  filter(rategroup == "3") %>%
  arrange(desc(Mean))

# Classify entities by 
data_rank2 <- data_init_mod %>%
  group_by(Entity) %>%
  mutate(rategroup = case_when(Entity %in% data_rank_high$Entity ~ "3",
                               Entity %in% data_rank_medium$Entity ~ "2",
                               Entity %in% data_rank_low$Entity ~ "1"))

# Create a line graph to show global trends
visual2 <- data_rank2 %>%
  filter(Year > "2009") %>%
  filter(Entity %in% head(data_rank_high$Entity, 10)|Entity %in% head(data_rank_medium$Entity, 10)|Entity %in% head(data_rank_low$Entity, 10)) %>%
  filter(!is.na(Death_alcohol_use_disorders)) %>%
  ggplot(aes(x = as.character(Year), y = Death_alcohol_use_disorders, group = Entity, color = rategroup)) +
  geom_line() +
  scale_color_manual(values=c("#FAA19B", "#f66257", "#b73229"))+
  facet_grid(rategroup~., scales = "free") +
  xlab("") +
  ylab("%Death from alcohol")

visual_2_interactive <- ggplotly(visual2) %>%
  layout(title = list(text = paste0("Death changes from alcohol use disorders 2010-2019 per group",
                                    "<br>",
                                    "<sup>")),
         annotations = list(x = 1, y = -0.1, text = "Data retreived from https://ourworldindata.org/alcohol-consumption.",
                         showarrow = F, xref='paper', yref='paper',
                         xanchor='right', yanchor='auto',
                         xshift=0, yshift=0,
                         font=list(size=10, color="Black")))

visual_2_interactive

```

****Table****
```{r TableSummary2, echo = FALSE, warning = FALSE, message = FALSE}
data_table2 <- data_init_mod %>%
  filter(!is.na(Death_alcohol_use_disorders) & !Year %in% c("2000", "2005")) %>%
  group_by(Entity) %>%
  summarize(Standard_deviation = sd(Death_alcohol_use_disorders, na.rm = TRUE)) %>%
  arrange(desc(Standard_deviation)) %>%
  top_n(20)

# Make the table
table2 <- knitr::kable(data_table2,
                       digits = 2,
                       caption = "The top 20 countries with highest variance in number of death caused by alcohol use disorders.")

table2

```


```{r, echo = FALSE, warning = FALSE, message = FALSE}
#Tony's section
data <- read.csv("Merge_all_2010_2020_updated.csv")

#wrangle data to only include specific regions and alcohol use disorders in males and females
alc_sex_regions <- data %>% 
  dplyr::select(Entity, Year, Prevalence_alcohol_use_disorders_male, 
         Prevalence_alcohol_use_disorders_female) %>%
  na.omit() %>%
  filter(Entity %in% c("African Region (WHO)", "Australia", "China", 
                       "European Region (WHO)", "United Kingdom", 
                       "United States"))

#wrangle data to only include income groups and alcohol use disorders in males and females
alc_sex_income <- data %>%
  dplyr::select(Entity, Year, Prevalence_alcohol_use_disorders_male, 
         Prevalence_alcohol_use_disorders_female) %>%
  na.omit() %>%
  filter(Entity %in% c("World Bank Low Income", "World Bank Lower Middle Income", 
                       "World Bank Upper Middle Income", "World Bank High Income"))
```

**What are the variations in the prevalence of alcohol disorders among men and women across different income groups?**

An association between income and alcohol disorders reveals noteworthy deviations from 2010 to 2019 but it is also important to consider the influence of other socioeconomic factors.

There is a noticeable distinction between the high-income group and other income groups as illustrated in Figure \@ref(fig:IncomeGraph). The percentage of alcohol disorders in the high-income group is significantly greater when compared with other income groups especially among females. This may be a result of females in the high-income group subject to societal expectations or gender roles which lead to increased alcohol related issues. There is a consistent trend indicating a higher prevalence of alcohol disorders among individuals from the higher income groups possibly with work pressures. 

Interestingly, the income groups among both males and females both have the lower-middle income group with the lowest rate of alcohol disorders. This may be due to considerations such as lower financial stressors and mental and physical well-being. However, the low and upper-middle income groups have a higher rate particularly among the males. Similarly, this may be due to financial and work stressors.

When comparing the rate of alcohol use disorders in 2010 and 2019 as shown in \@ref(tab:IncomeTable), both males and females have similar trends. It can be noted there have been decrease in males with alcohol use disorders for the high income group and significantly in lower-middle income group by 0.14%. A parallel trend follows for females in the high and lower-middle income groups. Males in the high income group are approximately double the rate of females with alcohol disorders. However, when compared males and females in the other income groups, the rate of alcohol disorders in males are roughly 4 times the rates in females. 

Interestingly, the income groups among both males and females both have the lower-middle income group with the lowest rate of alcohol disorders. This may be due to considerations such as lower financial stressors and mental and physical well-being. However, the low and upper-middle income groups have a higher rate particularly among the males. Similarly, this may be due to financial and work stressors. Furthermore, it is crucial to understand that the working population in each income group may be not accurate and the income brackets of each group may be skewed. Regardless of the data limitations, there are several variations in the prevalence of alcohol disorders among men and women across different income groups.

```{r IncomeGraph, fig.cap="Percentage of males and females with alcohol use disorders across different income groups", echo = FALSE, warning = FALSE, message = FALSE}

#create variable to plot male data across different income groups 
male_income <- ggplot(data = alc_sex_income, aes(x = Year)) +
  geom_line(aes(y = Prevalence_alcohol_use_disorders_male, color = Entity)) +
  labs(x = "Year", y = "% with alcohol use disorders", title = "Male", color = "Income Group") +
  scale_color_manual(values = c("blue", "green", "orange", "red"),
                     labels = c("Low", "Lower Middle", "Upper Middle", "High"),
                     breaks = c("World Bank Low Income", "World Bank Lower Middle Income", 
                                "World Bank Upper Middle Income", "World Bank High Income")) +
  theme(legend.position = "none", plot.title = element_text(hjust = 0.5)) +
  scale_x_continuous(breaks = seq(2010, 2019, 2)) + 
  scale_y_continuous(breaks = seq(1.75, 3, 0.25))

#create variable to plot female data across different income groups 
female_income <- ggplot(data = alc_sex_income, aes(x = Year)) +
  geom_line(aes(y = Prevalence_alcohol_use_disorders_female, color = Entity)) +
  labs(x = "Year", y = "% with alcohol use disorders", title = "Female", color = "Income Group") +
  scale_color_manual(values = c("blue", "green", "orange", "red"),
                     labels = c("Low", "Lower Middle", "Upper Middle", "High"),
                     breaks = c("World Bank Low Income", "World Bank Lower Middle Income", 
                                "World Bank Upper Middle Income", "World Bank High Income")) +
  theme(legend.position = "right", plot.title = element_text(hjust = 0.5)) +
  scale_x_continuous(breaks = seq(2010, 2019, 2)) +
  scale_y_continuous(breaks = seq(0.4, 1.6, 0.2))

#merge both male and female plots into one figure
grid.arrange(male_income, female_income, ncol = 1)
```

```{r IncomeTable, echo = FALSE, warning = FALSE, message = FALSE}
#create data frame for only 2010 and 2019 data
alc_sex_income_10_19 <- alc_sex_income %>%
  filter(Year %in% c(2010,2019))

#create kable table to display data for 2010 and 2019 %
kable(alc_sex_income_10_19, caption = "Percentage of males and females in different income groups with alcohol use disorders in 2010 and 2019")
```

**What is the temporal trend in the prevalence of alcohol disorders among men and women across major regions?**

By observing Figure \@ref(fig:RegionGraph), across all regions, it is clear there is a higher percentage of males with alcohol disorders than females and this statistic has not changed over the period 2010 to 2019. However, there is no evident similar trends between each region as there are various attributable factors such as evolving social norms, increased alcohol availability and alterations in cultural traditions. Regardless, there is an apparent upsurge over this period in the percentage males with alcohol issues are increasing in Australia, China and the United Kingdom. This is also noticeable among females in Australia but in other regions, there are insignificant increases or dips. 

In Table \@ref(tab:RegionTab), the same deductions can be derived. It can be assumed with the an ever-increasing human population, the percentage of individuals with alcohol use disorders across different regions can differ drastically over the 2010 to 2019 period. Regardless of this limitation, it is evident alcohol is a significant problem in areas around the world especially when the population is increasing.

```{r RegionGraph, fig.cap = "Percentage of males and females with alcohol use disorders among major regions from 2010 to 2019", echo = FALSE, warning = FALSE, message = FALSE}
#create plot for males and females across different regions using facet_wrap
ggplot(data = alc_sex_regions, aes(x = Year)) +
  geom_line(aes(y = Prevalence_alcohol_use_disorders_male, color = "Male")) +
  geom_line(aes(y = Prevalence_alcohol_use_disorders_female, color = "Female")) +
  labs(x = "Year", y = "% with alcohol use disorders", 
       title = "Percentage of Alcohol Disorders", 
       color = "Sex") +
   scale_color_manual(values = c("blue", "hot pink"),
                     labels = c("Male", "Female"),
                     breaks = c("Male", "Female")) + 
  theme(legend.position = "right", plot.title = element_text(hjust = 0.5)) +
  scale_x_continuous(breaks = seq(2010, 2019, 2)) + 
  facet_wrap(~ Entity, ncol = 2, scales = "free_y")

```

```{r RegionTab, echo = FALSE, warning = FALSE, message = FALSE}
#create data frame for only 2010 and 2019 data
alc_sex_regions_10_19 <- alc_sex_regions %>%
  filter(Year %in% c(2010,2019))

#create kable table to display data for 2010 and 2019 %
kable(alc_sex_regions_10_19, caption = "Percentage of males and females in different regions with alcohol use disorders in 2010 and 2019")

```




**Reference** 
H, Ritchie and M, Roser. (2018) <i>Alcohol Consumption</i>. OurWorldInData.org. https://ourworldindata.org/alcohol-consumption' 










## Question 2





# Section Tony {.tabset}


## Question 1




## Question 2



# Section Gloria {.tabset}


## Question 1




## Question 2




# Conclusion
It is evident alcohol use continues to be a significant problem today. Although the data used is a simple snippet during the period 2010 to 2019, there are various external factors providing such widespread results.

Firstly, total alcohol consumption presented diverging trends over time, as some regions experienced growth while others declined.  Particularly, the Middle East, North Africa, and the Greater Indonesia region displayed consistency in low alcohol usage, which suggests a potential influence of religion given the prevalence of Islamic values in these countries. However, further information is needed to determine the relationship between religion and alcohol consumption.

Secondly, it is clear both males and females in the high-income group have a higher percentage with alcohol use disorders. Additionally, the temporal trend in the prevalence of alcohol disorders across major regions have shown Australia, China and the UK to have significant rises in males with alcohol use orders with other regions showing minor decline. Furthermore, the rate of females with alcohol use disorders have not altered drastically.

Thirdly, deaths from alcohol tend to be more prevalent in countries with cold and dry climates. However, social, cultural, and economic factors are more of our interest to investigate because, whereas we cannot do much about a countrys weather, we could understand what is causing people to drink too much, which would potentially allow us to design educational and addiction treatment programs to offer support.

Lastly, the conducted analysis does suggest that an increase in personal income does increase the tendency to consume more alcohol. However, maybe because of a limit on how much alcohol can be consumed by a person, the consumption of alcohol does not increase further beyond a certain income threshold. The exploration of the data available suggests that percentage death in alcohol use disorders increases with an increase in alcohol consumption and household alcohol expense, which would make sense as both alcohol consumption and alcohol expense are directly related. On the contrary, percentage deaths from alcohol use disorders actually decreases with an increase in GDP Per Capita, which is also reiterated when we explored some of the countries with the highest percentage of deaths from alcohol use disorders in 2015. The insights obtained in this report are suggestive that death may be dependent on additional predictors such as consumption of unsafe and low quality alcohol, comparatively poorer individual health, lack of quality and affordable healthcare and provides highly relevant topics for future research.

As we explored the relationship between income and alcohol consumption, as well as factors leading to alcohol-related deaths, valuable insights were discovered surrounding this issue although there may be limitations with external factors not considered in this report. By recognizing the relationship between geographical regions, social factors, and alcohol consumption, we can develop targeted interventions and strategies to mitigate the negative effects of alcohol use disorders. 


# References


