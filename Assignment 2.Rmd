---
title: "Alcohol"
author: "Naveed Aamir"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r installPackages, echo=FALSE}
install.packages("tidyverse", repos = "http://cran.us.r-project.org")
install.packages("knitr", repos = "http://cran.us.r-project.org")
install.packages("readr", repos = "http://cran.us.r-project.org")
install.packages("dplyr", repos = "http://cran.us.r-project.org")
install.packages("broom", repos = "http://cran.us.r-project.org")
install.packages("forecast", repos = "http://cran.us.r-project.org")
install.packages("repr", repos = "http://cran.us.r-project.org")
install.packages("lubridate", repos = "http://cran.us.r-project.org")
install.packages("janitor", repos = "http://cran.us.r-project.org")
# *****
```


```{r loadLibraries, echo=FALSE}
# load the required libraries
library(tidyverse, quietly = T)
library(knitr, quietly = T)
library(readr, quietly = T)
library(dplyr, quietly = T)
library(broom, quietly = T)
library(forecast, quietly = T)
library(repr, quietly = T)
library(lubridate, quietly = T)
library(janitor, quietly = T)
# *****
```

# ASSESSMENT 2 



## INTRODUCTION

```{r readData and review, echo=FALSE}
# Read data and review
alcohol <- read.csv("Data/alcohol.csv")
# *****
```



# Section Naveed {.tabset}


## Question 1

- Do people with higher income consume more alcohol and how does the consumption of alcohol vary with an increase in income?

```{r}
# scatter plot of consumption per person vs income

options(scipen = 999)

sp <- ggplot(data = alcohol, aes(x = GDP_per_capita, y = Total_alcohol_consumption_per_capita)) +
  geom_point() + scale_x_continuous(trans = 'log10')

# Wrangle and get the data ready for the model
alcohol2 <- filter(alcohol, GDP_per_capita>=0, GDP_per_capita<=70000) %>% select(Entity,GDP_per_capita,Total_alcohol_consumption_per_capita)

alcohol3 <- na.omit(alcohol2)

# Fit a simple linear regression model of consumption per person on income
con_fit <- lm(Total_alcohol_consumption_per_capita~GDP_per_capita, data=alcohol3)
#tidy(con_fit)
# Add predictions, residuals, etc. to the training data
con_model <- augment(con_fit, alcohol3)

# Fitting the estimated model over the data
con_mod <- ggplot(con_model, aes(x=GDP_per_capita, y=Total_alcohol_consumption_per_capita)) + 
  geom_point() +
  geom_line(aes(y=.fitted), colour="blue")

options(scipen = 999)
con_mod

#con_modi <- ggplotly(con_mod)
#con_modi
# *****


# Summary of the fitted linear regression model
con_lin_fit <- lm(formula = Total_alcohol_consumption_per_capita ~ GDP_per_capita, data = alcohol3)

# Return a summary of the fitted linear regression model
summary(con_lin_fit)

# Table that displays five countries each for both highest gdp per capita and lowest gdp per capita
alcohol10 <- arrange(alcohol3, desc(GDP_per_capita))

alcohol_gdp <- filter(alcohol10, Entity %in% c("Switzerland", "Brunei", "United Arab Emirates", "Norway", "United States", "Burundi", "Central African Republic", "Democratic Republic of Congo", "Somalia", "Mozambique"))

alcohol_gdp

# *****
```





## Question 2

- Is death dependant on consumption, income and alcohol household expense? % Death prediction with x1 consumption, x2 income and x3 alcohol household expense. Which countries had the highest percentage of alcohol related deaths in 2015? Are there any interesting findings and any possible potential underlying reasons? 

```{r readData and review, echo=FALSE}
# Read data and review
alcohol <- read.csv("Data/alcohol.csv")

# scatter plot of consumption vs income
year18 <- filter(alcohol, Year == 2018)

options(scipen = 999)

sp <- ggplot(data = year18, aes(x = GDP_per_capita, y = Total_alcohol_consumption_per_capita)) +
  geom_point() + scale_x_continuous(trans = 'log10')
sp
# *****
```

```{r}
# select variables for regression
selected.var <- c(4, 6, 11, 12)
# partition data
set.seed(1)  # set seed for reproducing the partition
train.index <- sample(c(1:3619), 2000) 
train.df <- alcohol[train.index, selected.var]
test.df <- alcohol[-train.index, selected.var]

# death regress on consumption, income and alcohol household expense
death_m <- lm(Death_alcohol_use_disorders ~., data = train.df)
options(scipen = 999)
summary(death_m)

# death model for the UK
death_uk <- filter(alcohol, Entity == "United Kingdom")

# select variables for regression of death on consumption
selected.var2 <- c(11, 12)
# partition data
set.seed(1)  # set seed for reproducing the partition
train.index <- sample(c(1:3619), 2000) 
train.df <- alcohol[train.index, selected.var2]
test.df <- alcohol[-train.index, selected.var2]

# death regress on consumption
death_m2 <- lm(Death_alcohol_use_disorders ~., data = train.df)
options(scipen = 999)
summary(death_m2)

# select variables for regression of death on income
selected.var3 <- c(4, 11)
# partition data
set.seed(1)  # set seed for reproducing the partition
train.index <- sample(c(1:3619), 2000) 
train.df <- alcohol[train.index, selected.var3]
test.df <- alcohol[-train.index, selected.var3]

# death regress on income
death_m3 <- lm(Death_alcohol_use_disorders ~., data = train.df)
options(scipen = 999)
summary(death_m3)

# select variables for regression of death on alcohol household expense rate
selected.var4 <- c(6, 11)
# partition data
set.seed(1)  # set seed for reproducing the partition
train.index <- sample(c(1:3619), 2000) 
train.df <- alcohol[train.index, selected.var4]
test.df <- alcohol[-train.index, selected.var4]

# death regress on alcohol household expense rate
death_m4 <- lm(Death_alcohol_use_disorders ~., data = train.df)
options(scipen = 999)
summary(death_m4)

# wrangling data
countries_2015 <- filter(alcohol, Year == 2015) %>% select(Entity, Death_alcohol_use_disorders, Total_alcohol_consumption_per_capita, GDP_per_capita, Alcohol_expenditure_rate_per_household) 

# countries with highest percentage of alcohol related deaths in 2015
countries_deaths <- arrange(countries_2015, desc(Death_alcohol_use_disorders))
# *****
```




# Section Jane {.tabset}


## Question 1








## Question 2





# Section Tony {.tabset}


## Question 1




## Question 2



# Section Gloria {.tabset}


## Question 1




## Question 2




# Conclusion




# References




# Appendix

