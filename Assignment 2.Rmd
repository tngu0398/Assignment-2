---
title: "Assignment 2"
authors: "Tony Nguyen, Jane Nguyen, Shiyuan Zhang, Naveed Aamir"
date: "2023-06-07"
output: 
  bookdown::html_document2: 
  fig_caption: yes
---


```{r setup, include = FALSE}

#loading libraries
library(ISLR)
library(MASS)
library(tidyr)
library(tidyverse)
library(ggplot2)
library(ggthemes)
library(ggrepel)
library(dplyr)
library(tidyverse)
library(ggmap)
library(maps)
library(mapdata) 
library(knitr)
library(kableExtra)
library(countrycode)
library(bookdown)

knitr::opts_chunk$set(echo = TRUE)

```

```{r, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}

# read in data set 
data = read.csv('Merge_all_2010_2020_updated.csv')

```

```{r, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}

# extracting columns to use from data 
extractedData =  data[, c(1, 2, 3, 12)]

# omit NA values
newExtractedData = na.omit(extractedData)

```

**Introduction**
The following report explores

*Question 1*

-   How has the total alcohol consumption per capita changed over time in relation to geographical regions?

**Analysis**

Table \@ref(tab:Table1) presented the overall median global growth of alcohol consumption from 2000 to 2018. However, Figure \@ref(fig:Figure1) revealed that regions were still experiencing diverging patterns during this period. Regions such as 'East Asia and Pacific', 'South Asia', 'North America' and 'Middle East and North Africa' increased in alcohol consumption, while other regions like 'Europe and Central Asia', 'Latin America and Caribbean' and 'Sub-Saharan Africa' experienced declines.

Table \@ref(tab:Table1) provided insights of the average (6.18L) and median (6.11L) alcohol consumption in 2010, this year stands as the highest in total consumption. Similarly, Figure 2 presents the visual depiction of countries around the world reaching their highest in 2010, followed by subsequent decrease.

------------------------------------------------------------------------

**Table 1**

Table \@ref(tab:Table1) displays the IQR, the range, Mean and Median values of total alcohol consumption in 2000, 2005, 2010, 2015 and 2018

```{r Table1, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}

# 2000 data
y2000 = newExtractedData[newExtractedData $ Year == 2000, ]

year2000Total = summary(y2000 $ Total_alcohol_consumption_per_capita)

year2000TotalArray = as.array(year2000Total)

year2000TotalData = data.frame(Statistics = rownames(year2000TotalArray), Values = year2000TotalArray, stringsAsFactors = FALSE)


# 2005 data
y2005 = newExtractedData[newExtractedData $ Year == 2005, ]

year2005Total = summary(y2005 $ Total_alcohol_consumption_per_capita)

year2005TotalArray = as.array(year2005Total)

year2005TotalData = data.frame(Statistics = rownames(year2005TotalArray), Values = year2005TotalArray, stringsAsFactors = FALSE)


# 2010 data
y2010 = newExtractedData[newExtractedData $ Year == 2010, ]

year2010Total = summary(y2010 $ Total_alcohol_consumption_per_capita)

year2010TotalArray = as.array(year2010Total)

year2010TotalData = data.frame(Statistics = rownames(year2010TotalArray), Values = year2010TotalArray, stringsAsFactors = FALSE)


# 2015 data
y2015 = newExtractedData[newExtractedData $ Year == 2015, ]

year2015Total = summary(y2015 $ Total_alcohol_consumption_per_capita)

year2015TotalArray = as.array(year2015Total)

year2015TotalData = data.frame(Statistics = rownames(year2015TotalArray), Values = year2015TotalArray, stringsAsFactors = FALSE)


# 2018 data
y2018 = newExtractedData[newExtractedData $ Year == 2018, ]

year2018Total = summary(y2018 $ Total_alcohol_consumption_per_capita)

year2018TotalArray = as.array(year2018Total)

year2018TotalData = data.frame(Statistics = rownames(year2018TotalArray), Values = year2018TotalArray, stringsAsFactors = FALSE)


# combining columns 
totalCombinedSummary = cbind(year2000TotalData$Statistics, year2000TotalData$Values.Freq, year2005TotalData$Values.Freq, year2010TotalData$Values.Freq, year2015TotalData$Values.Freq, year2018TotalData$Values.Freq)

# renaming columns 
colnames(totalCombinedSummary) = c("Statistics", "2000", "2005", "2010", "2015", "2018")

# presenting using kable()
kable(totalCombinedSummary, format = "html", align = "c", caption = "Alcohol Consumption Statistics throughout the Years") %>% kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)

```

------------------------------------------------------------------------

**Figure 1**

Figure \@ref(fig:Figure1) displays the trends in total alcohol consumption across geographical regions from 2000 to 2018, with the World's rate shown as a dot-dashed line

-   'Europe and Central Asia' region experienced a notable decrease in consumption, while 'Latin America and Caribbean' and 'Sub-Saharan Africa' regions saw slight declines

-   'East Asia and Pacific' and 'South Asia' regions presented rapid growth, particularly between 2005 and 2010

-   'North America' and 'Middle East and North Africa' regions had minor increases, however the 'Middle East and North Africa' remained the lowest

```{r Figure1, fig.cap = "Region Chart", echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}

# selecting specific regions 
specifiedRegions = c("World", "East Asia and Pacific", "Europe and Central Asia", "Latin America and Caribbean", "Middle East and North Africa", "North America", "South Asia", "Sub-Saharan Africa")

specifiedRegionsData = newExtractedData %>% filter(Entity %in% specifiedRegions)

# create chart with World being a dotdash line type 
regionChart = ggplot(specifiedRegionsData, aes(x = Year, y = Total_alcohol_consumption_per_capita, group = Entity, color = Entity)) + geom_line(aes(linetype= if_else(Entity == "World", "solid", "dotdash"))) + geom_point() + labs(x = "Year", y = "Alcohol Consumption in Litres", title = "Total Alcohol Consumption by Geographical Region") + scale_linetype_manual(values = c("solid", "dotdash"), guide = FALSE) + theme_minimal()

regionChart

```

------------------------------------------------------------------------

*Question 2*

-   How does the influence of religion relate to variations in total alcohol consumption per capita across different locations?

**Analysis**

Figure \@ref(fig:Figure1) highlighted the region 'Middle East and North Africa' as having had experienced the least growth and changes from 2000 to 2018 in comparison to the others. Notably, 'Middle East and North Africa' consistently exhibited the lowest alcohol consumption (consuming less than 1L each year). Similarly, Figure 2 shows the geographical locations: the Middle East, North Africa and the Greater Indonesia to have had minor changes over the years.

Table \@ref(tab:Table2) demonstrates consistency among the lowest 10 countries in alcohol consumption over the years, with only minor variations. Interestingly, a significant number of these countries are known for their devotion of Islamic values.

Although the impact of religion on alcohol consumption cannot be definitively determined without further global religious information. Figure \@ref(fig:Figure1), Table \@ref(tab:Table2) and Figure 2 suggest that these locations (the Middle East, North Africa and the Greater Indonesia) may experience lower alcohol consumption due to religious beliefs.

------------------------------------------------------------------------

**Figure 2**

Figure 2 presents the alcohol consumption per capita in 2000, 2005, 2010, 2015 and 2018. Some notable observations are:

-   In 2000, Russia showed high alcohol consumption but over time it declined to 11.19L in 2018

-   In 2010, most countries had their highest rate of alcohol consumption

-   From 2000 to 2018, the majority of North Africa, the Middle East and the Greater Indonesia regions presented minimal changes in alcohol consumption - this may be attributed by Islamic beliefs as the Quran deems drinking as haram

```{r, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}

# loading world map 
worldMap = map_data("world")

# selecting specific year 2000
extractedData2000 = filter(newExtractedData, Year == 2000)

worldMap $ iso3c = countrycode(worldMap$region, 'country.name', 'iso3c')

extractedData2000Map = left_join(worldMap, extractedData2000, by = c("iso3c" = "Code"))

# heat map based on total alcohol consumption in 2000 
dataMap2000 = ggplot() + geom_map(data = extractedData2000Map, map = extractedData2000Map, aes(x = long, y = lat, map_id = region, fill = Total_alcohol_consumption_per_capita), color = "black") + coord_equal() + theme_void() + scale_fill_gradient2(low = "white", mid = "lightblue", high = "darkred", name = "Alcohol Consumed (Litres)") + labs(title = "2000 Alcohol Consumption per Capita")


# selecting specific year 2005
extractedData2005 = filter(newExtractedData, Year == 2005)

extractedData2005Map = left_join(worldMap, extractedData2005, by = c("iso3c" = "Code"))

# heat map based on total alcohol consumption in 2005 
dataMap2005 = ggplot() + geom_map(data = extractedData2005Map, map = extractedData2005Map, aes(x = long, y = lat, map_id = region, fill = Total_alcohol_consumption_per_capita), color = "black") + coord_equal() + theme_void() + scale_fill_gradient2(low = "white", mid = "lightblue", high = "darkred", name = "Alcohol Consumed (Litres)") + labs(title = "2005 Alcohol Consumption per Capita")


# selecting specific year 2010
extractedData2010 = filter(newExtractedData, Year == 2010)

extractedData2010Map = left_join(worldMap, extractedData2010, by = c("iso3c" = "Code"))

# heat map based on total alcohol consumption in 2010 
dataMap2010 = ggplot() + geom_map(data = extractedData2010Map, map = extractedData2010Map, aes(x = long, y = lat, map_id = region, fill = Total_alcohol_consumption_per_capita), color = "black") + coord_equal() + theme_void() + scale_fill_gradient2(low = "white", mid = "lightblue", high = "darkred", name = "Alcohol Consumed (Litres)") + labs(title = "2010 Alcohol Consumption per Capita")


# selecting specific year 2015
extractedData2015 = filter(newExtractedData, Year == 2015)

extractedData2015Map = left_join(worldMap, extractedData2015, by = c("iso3c" = "Code"))

# heat map based on total alcohol consumption in 2015 
dataMap2015 = ggplot() + geom_map(data = extractedData2015Map, map = extractedData2015Map, aes(x = long, y = lat, map_id = region, fill = Total_alcohol_consumption_per_capita), color = "black") + coord_equal() + theme_void() + scale_fill_gradient2(low = "white", mid = "lightblue", high = "darkred", name = "Alcohol Consumed (Litres)") + labs(title = "2015 Alcohol Consumption per Capita")


# selecting specific year 2018
extractedData2018 = filter(newExtractedData, Year == 2018)   

extractedData2018Map = left_join(worldMap, extractedData2018, by = c("iso3c" = "Code"))

# heat map based on total alcohol consumption in 2018 
dataMap2018 = ggplot() + geom_map(data = extractedData2018Map, map = extractedData2018Map, aes(x = long, y = lat, map_id = region, fill = Total_alcohol_consumption_per_capita), color = "black") + coord_equal() + theme_void() + scale_fill_gradient2(low = "white", mid = "lightblue", high = "darkred", name = "Alcohol Consumed (Litres)") + labs(title = "2018 Alcohol Consumption per Capita")


# display graphs using par()
par(mfrow = c(3, 2))
plot(dataMap2000)
plot(dataMap2005)
plot(dataMap2010)
plot(dataMap2015)
plot(dataMap2018)

```

------------------------------------------------------------------------

**Table 2**

Table 2 \@ref(tab:Table2) presents the lowest 10 countries in 2000, 2005, 2010, 2015 and 2018 in alcohol consumption

```{r Table2, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}

# calculating the total alcohol consumption in 2000
total2000 = extractedData2000 %>% group_by(Entity) %>% summarize(Total = sum(Total_alcohol_consumption_per_capita))

# arranging total consumption in descending order
topTotal2000 = arrange(total2000, desc(Total))

# selecting the bottom 15 countries in 2000
tailTotal2000 = tail(topTotal2000, 10)


# calculating the total alcohol consumption in 2005
total2005 = extractedData2005 %>% group_by(Entity) %>% summarize(Total = sum(Total_alcohol_consumption_per_capita))

# arranging total consumption in descending order
topTotal2005 = arrange(total2005, desc(Total))

# selecting the bottom 15 countries in 2005
tailTotal2005 = tail(topTotal2005, 10)


# calculating the total alcohol consumption in 2010
total2010 = extractedData2010 %>% group_by(Entity) %>% summarize(Total = sum(Total_alcohol_consumption_per_capita))

# arranging total consumption in descending order
topTotal2010 = arrange(total2010, desc(Total))

# selecting the bottom 15 countries in 2010
tailTotal2010 = tail(topTotal2010, 10)


# calculating the total alcohol consumption in 2015
total2015 = extractedData2015 %>% group_by(Entity) %>% summarize(Total = sum(Total_alcohol_consumption_per_capita))

# arranging total consumption in descending order
topTotal2015 = arrange(total2015, desc(Total))

# selecting the bottom 15 countries in 2015
tailTotal2015 = tail(topTotal2015, 10)


# calculating the total alcohol consumption in 2018
total2018 = extractedData2018 %>% group_by(Entity) %>% summarize(Total = sum(Total_alcohol_consumption_per_capita))

# arranging total consumption in descending order
topTotal2018 = arrange(total2018, desc(Total))

# selecting the bottom 15 countries in 2018
tailTotal2018 = tail(topTotal2018, 10)


# combining the data for each year into one 
combinedData = bind_rows(mutate(tailTotal2000, Year = 2000), mutate(tailTotal2005, Year = 2005), mutate(tailTotal2010, Year = 2010), mutate(tailTotal2015, Year = 2015), mutate(tailTotal2018, Year = 2018))

# creating separate columns for each year
combinedData = pivot_wider(data = combinedData, id_cols = Entity, names_from = Year, values_from = Total)

# converting to character type and replacing NA values with '-'
combinedData = combinedData %>% mutate(across(everything(), as.character)) %>% replace_na(list(`2000` = '-', `2005` = '-', `2010` = '-', `2015` = '-', `2018` = '-'))

# display table using kable()
kable(combinedData, format = "html", align = "c", caption = "Bottom 10 Countries in Alcohol Consumption (Litres)") %>% kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)

```
